var $hEp4C$datefns=require("date-fns");
var $hEp4C$imagetobase64=require("image-to-base64");
var $hEp4C$qs=require("qs");
var $hEp4C$crossfetch=require("cross-fetch");
var $hEp4C$nanoid=require("nanoid");
var $hEp4C$cryptojs=require("crypto-js");
var $hEp4C$url=require("url");
function $parcel$interopDefault(a){return a&&a.__esModule?a.default:a}
function $parcel$export(e,n,v,s){Object.defineProperty(e,n,{get:v,set:s,enumerable:true,configurable:true})}
$parcel$export(module.exports,"SolapiMessageService",()=>$a6e71734afd89a96$export$34e7265c65c60ffd);class $3e8e1a04ac44db56$export$7522646e65a7a5d1 extends Error{constructor(message){super(message);this.name="InvalidDateError"}}class $3e8e1a04ac44db56$export$6efc4418efdbd5bb extends Error{constructor(message){super(message);this.name="InvalidApiKeyError"}}class $3e8e1a04ac44db56$export$c73ca302efeda3b4 extends Error{constructor(errorCode,errorMessage){super(errorMessage);this.name=errorCode}}class $3e8e1a04ac44db56$export$b75729dbe9bbac3a extends Error{constructor(errorList){super(JSON.stringify(errorList));this.name="MessagesNotReceivedError"}}function $551d0f39d46708b0$export$2e2bcd8739ae039(value){if(typeof value==="string"){value=(0,$hEp4C$datefns.parseISO)(value);const invalidDateText="Invalid Date";if(value.toString()===invalidDateText)throw new(0,$3e8e1a04ac44db56$export$7522646e65a7a5d1)(invalidDateText)}return value}const $7467382afc84c32e$var$sdkVersion="nodejs/5.1.4";const $7467382afc84c32e$export$fb47e5c0b633ea53={sdkVersion:$7467382afc84c32e$var$sdkVersion,osPlatform:`${process.platform} | ${process.version}`};class $7467382afc84c32e$var$DefaultMessageRequest{constructor(){this.agent=$7467382afc84c32e$export$fb47e5c0b633ea53;this.allowDuplicates=false}}class $7467382afc84c32e$export$ad3dca884a810e33 extends $7467382afc84c32e$var$DefaultMessageRequest{constructor(message,allowDuplicates,appId){super();this.message=message;if(typeof allowDuplicates==="boolean")this.allowDuplicates=allowDuplicates;if(appId)this.agent.appId=appId}}class $7467382afc84c32e$export$b4becc1d7edb915a extends $7467382afc84c32e$var$DefaultMessageRequest{constructor(messages,allowDuplicates,appId){super();this.messages=messages;if(typeof allowDuplicates==="boolean")this.allowDuplicates=allowDuplicates;if(appId)this.agent.appId=appId}}class $7467382afc84c32e$export$c4f11270a1f4daf1 extends $7467382afc84c32e$var$DefaultMessageRequest{constructor(messages,allowDuplicates,appId,scheduledDate){super();this.messages=messages;if(typeof allowDuplicates==="boolean")this.allowDuplicates=allowDuplicates;if(appId)this.agent.appId=appId;if(scheduledDate)this.scheduledDate=(0,$hEp4C$datefns.formatISO)((0,$551d0f39d46708b0$export$2e2bcd8739ae039)(scheduledDate))}}class $7467382afc84c32e$export$6ba9c27a351bdec2{constructor(messages){this.messages=messages}}class $7467382afc84c32e$export$d88a1c09ffb9e02d{dateType="CREATED";constructor(getMessageRequestType){this.startKey=getMessageRequestType.startKey;this.limit=getMessageRequestType.limit;if(getMessageRequestType.duration?.dateType)this.dateType=getMessageRequestType.duration.dateType;if(getMessageRequestType.duration)this.startDate=(0,$hEp4C$datefns.formatISO)((0,$551d0f39d46708b0$export$2e2bcd8739ae039)(getMessageRequestType.duration.startDate));if(getMessageRequestType.duration)this.endDate=(0,$hEp4C$datefns.formatISO)((0,$551d0f39d46708b0$export$2e2bcd8739ae039)(getMessageRequestType.duration.endDate));this.messageId=getMessageRequestType.messageId;this.messageIds=getMessageRequestType.messageIds;this.groupId=getMessageRequestType.groupId;this.to=getMessageRequestType.to;this.from=getMessageRequestType.from;this.type=getMessageRequestType.type;this.statusCode=getMessageRequestType.statusCode}}class $7467382afc84c32e$export$4fede39aef110b5c{constructor(getStatisticsRequest){if(getStatisticsRequest.duration)this.startDate=(0,$hEp4C$datefns.formatISO)((0,$551d0f39d46708b0$export$2e2bcd8739ae039)(getStatisticsRequest.duration.startDate));if(getStatisticsRequest.duration)this.endDate=(0,$hEp4C$datefns.formatISO)((0,$551d0f39d46708b0$export$2e2bcd8739ae039)(getStatisticsRequest.duration.endDate));this.masterAccountId=getStatisticsRequest.masterAccountId}}let $7b1a054c0937d4c0$var$AuthenticateType;(function(AuthenticateType){AuthenticateType[AuthenticateType["API_KEY"]=0]="API_KEY"})($7b1a054c0937d4c0$var$AuthenticateType||($7b1a054c0937d4c0$var$AuthenticateType={}));function $7b1a054c0937d4c0$export$2e2bcd8739ae039(authenticationParameter,authType=$7b1a054c0937d4c0$var$AuthenticateType.API_KEY){const{apiKey,apiSecret}=authenticationParameter;switch(authType){case $7b1a054c0937d4c0$var$AuthenticateType.API_KEY:default:const salt=(0,$hEp4C$nanoid.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",32)();const date=(0,$hEp4C$datefns.formatISO)(new Date);const hmacData=date+salt;if(!apiKey||!apiSecret||apiKey===""||apiSecret==="")throw new(0,$3e8e1a04ac44db56$export$6efc4418efdbd5bb)("Invalid API Key Error");const signature=(0,$hEp4C$cryptojs.HmacSHA256)(hmacData,apiSecret).toString();return`HMAC-SHA256 apiKey=${apiKey}, date=${date}, salt=${salt}, signature=${signature}`}}async function $f24672c3715df8a1$export$2e2bcd8739ae039(authParameter,request,data){const authorizationHeaderData=(0,$7b1a054c0937d4c0$export$2e2bcd8739ae039)(authParameter);return await(0,$parcel$interopDefault($hEp4C$crossfetch))(request.url,{headers:{Authorization:authorizationHeaderData,"Content-Type":"application/json"},body:JSON.stringify(data),method:request.method}).then(async res=>{if(res.status>=400&&res.status<500){const errorResponse=await res.json();throw new(0,$3e8e1a04ac44db56$export$c73ca302efeda3b4)(errorResponse.errorCode,errorResponse.errorMessage)}else if(res.status>=500){const responseText=await res.text();throw new(0,$3e8e1a04ac44db56$export$c73ca302efeda3b4)("UnknownException",responseText)}try{return res.json()}catch(exception){throw new Error(await res.text())}})}function $ff8f5d4d31c52cf4$export$2e2bcd8739ae039(url,data){const apiUrl=new(0,$hEp4C$url.URL)(url);if(data){const urlSearchParams=new(0,$hEp4C$url.URLSearchParams);Object.keys(data).forEach(key=>{const reflectedValue=Reflect.get(data,key);if(reflectedValue)urlSearchParams.append(key,reflectedValue)});apiUrl.search=urlSearchParams.toString()}return apiUrl.toString()}class $a6e71734afd89a96$export$34e7265c65c60ffd{baseUrl="https://api.solapi.com";constructor(apiKey,apiSecret){this.authInfo={apiKey:apiKey,apiSecret:apiSecret}}async send(messages,scheduledDate,allowDuplicates=false,appId){if(!Array.isArray(messages))messages=[messages];const parameter=new(0,$7467382afc84c32e$export$c4f11270a1f4daf1)(messages,allowDuplicates,appId,scheduledDate);const requestConfig={method:"POST",url:`${this.baseUrl}/messages/v4/send-many/detail`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig,parameter).then(res=>{const count=res.groupInfo.count;if(res.failedMessageList.length>0&&count.total===count.registeredFailed)throw new(0,$3e8e1a04ac44db56$export$b75729dbe9bbac3a)(res.failedMessageList);return res})}async sendOne(message,appId){const parameter=new(0,$7467382afc84c32e$export$ad3dca884a810e33)(message,false,appId);const requestConfig={method:"POST",url:`${this.baseUrl}/messages/v4/send`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig,parameter)}async sendOneFuture(message,scheduledDate){const groupId=await this.createGroup();await this.addMessagesToGroup(groupId,[message]);scheduledDate=(0,$551d0f39d46708b0$export$2e2bcd8739ae039)(scheduledDate);return this.reserveGroup(groupId,scheduledDate)}async sendMany(messages,allowDuplicates=false,appId){const parameter=new(0,$7467382afc84c32e$export$b4becc1d7edb915a)(messages,allowDuplicates,appId);const requestConfig={method:"POST",url:`${this.baseUrl}/messages/v4/send-many`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig,parameter)}async sendManyFuture(messages,scheduledDate,allowDuplicates=false,appId){const groupId=await this.createGroup(allowDuplicates,appId);await this.addMessagesToGroup(groupId,messages);scheduledDate=(0,$551d0f39d46708b0$export$2e2bcd8739ae039)(scheduledDate);return this.reserveGroup(groupId,scheduledDate)}async createGroup(allowDuplicates,appId){allowDuplicates=allowDuplicates??false;const{sdkVersion,osPlatform}=(0,$7467382afc84c32e$export$fb47e5c0b633ea53);const requestConfig={method:"POST",url:`${this.baseUrl}/messages/v4/groups`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig,{sdkVersion:sdkVersion,osPlatform:osPlatform,allowDuplicates:allowDuplicates,appId:appId}).then(res=>res.groupId)}async addMessagesToGroup(groupId,messages){const requestConfig={method:"PUT",url:`${this.baseUrl}/messages/v4/groups/${groupId}/messages`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig,new(0,$7467382afc84c32e$export$6ba9c27a351bdec2)(messages))}async sendGroup(groupId){const requestConfig={method:"POST",url:`${this.baseUrl}/messages/v4/groups/${groupId}/send`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async reserveGroup(groupId,scheduledDate){const requestConfig={method:"POST",url:`${this.baseUrl}/messages/v4/groups/${groupId}/schedule`};const formattedScheduledDate=(0,$hEp4C$datefns.formatISO)(scheduledDate);return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig,{scheduledDate:formattedScheduledDate})}async getGroup(groupId){const requestConfig={method:"GET",url:`${this.baseUrl}//messages/v4/groups/${groupId}`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async getGroups(data){const endpoint=(0,$ff8f5d4d31c52cf4$export$2e2bcd8739ae039)(`${this.baseUrl}/messages/v4/groups`,data);const requestConfig={method:"GET",url:endpoint};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async getGroupMessages(groupId,data){const endpoint=(0,$ff8f5d4d31c52cf4$export$2e2bcd8739ae039)(`${this.baseUrl}/messages/v4/groups/${groupId}/messages`,data);const requestConfig={method:"GET",url:endpoint};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async removeGroupMessages(groupId,messageIds){const requestConfig={method:"DELETE",url:`${this.baseUrl}/messages/v4/groups/${groupId}/messages`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig,{messageIds:messageIds})}async removeReservationToGroup(groupId){const requestConfig={method:"DELETE",url:`${this.baseUrl}/messages/v4/groups/${groupId}/schedule`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async removeGroup(groupId){const requestConfig={method:"DELETE",url:`${this.baseUrl}/messages/v4/groups/${groupId}`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async getMessages(data){const parameter=data?new(0,$7467382afc84c32e$export$d88a1c09ffb9e02d)(data):{};const endpoint=(0,$ff8f5d4d31c52cf4$export$2e2bcd8739ae039)(`${this.baseUrl}/messages/v4/list`,parameter);const requestConfig={method:"GET",url:endpoint};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async getStatistics(data){const parameter=data?new(0,$7467382afc84c32e$export$4fede39aef110b5c)(data):{};const endpoint=(0,$ff8f5d4d31c52cf4$export$2e2bcd8739ae039)(`${this.baseUrl}/messages/v4/statistics`,parameter);const requestConfig={method:"GET",url:endpoint};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async getBalance(){const requestConfig={method:"GET",url:`${this.baseUrl}/cash/v1/balance`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async uploadFile(filePath,fileType,name,link){const encodedFile=await(0,$parcel$interopDefault($hEp4C$imagetobase64))(filePath);const requestConfig={method:"POST",url:`${this.baseUrl}/storage/v1/files`};const parameter={file:encodedFile,type:fileType,name:name,link:link};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig,parameter)}async getKakaoChannelCategories(){const requestConfig={method:"GET",url:`${this.baseUrl}/kakao/v2/channels/categories`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async getKakaoChannels(data){const payload=data;if(payload?.dateCreated&&typeof payload?.dateCreated!="undefined"){const dateCreatedPayload=payload.dateCreated;Object.keys(dateCreatedPayload).forEach(key=>{const dateKey=key;const dateCreated=dateCreatedPayload[dateKey];if(dateCreated){const formattedDateCreated=(0,$hEp4C$datefns.formatISO)((0,$551d0f39d46708b0$export$2e2bcd8739ae039)(dateCreated));if(payload.dateCreated)payload.dateCreated[dateKey]=formattedDateCreated}})}if(data?.dateUpdated&&typeof payload?.dateUpdated!="undefined"){const dateUpdatedPayload=payload.dateUpdated;Object.keys(dateUpdatedPayload).forEach(key=>{const dateKey=key;const dateUpdated=dateUpdatedPayload[dateKey];if(dateUpdated){const formattedDateUpdated=(0,$hEp4C$datefns.formatISO)((0,$551d0f39d46708b0$export$2e2bcd8739ae039)(dateUpdated));if(payload.dateUpdated)payload.dateUpdated[dateKey]=formattedDateUpdated}})}const parameter=(0,$parcel$interopDefault($hEp4C$qs)).stringify(payload,{indices:false});const endpoint=`${this.baseUrl}/kakao/v2/channels?${parameter}`;const requestConfig={method:"GET",url:endpoint};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async getKakaoChannel(channelId){const requestConfig={method:"GET",url:`${this.baseUrl}/kakao/v2/channels/${channelId}`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async requestKakaoChannelToken(data){const requestConfig={method:"POST",url:`${this.baseUrl}/kakao/v2/channels/token`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig,data)}async createKakaoChannel(data){const requestConfig={method:"POST",url:`${this.baseUrl}/kakao/v2/channels`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig,data)}async removeKakaoChannel(channelId){const requestConfig={method:"DELETE",url:`${this.baseUrl}/kakao/v2/channels/${channelId}`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async getKakaoAlimtalkTemplates(data){const payload=data;if(payload?.dateCreated&&typeof payload?.dateCreated!="undefined"){const dateCreatedPayload=payload.dateCreated;Object.keys(dateCreatedPayload).forEach(key=>{const dateKey=key;const dateCreated=dateCreatedPayload[dateKey];if(dateCreated){const formattedDateCreated=(0,$hEp4C$datefns.formatISO)((0,$551d0f39d46708b0$export$2e2bcd8739ae039)(dateCreated));if(payload.dateCreated)payload.dateCreated[dateKey]=formattedDateCreated}})}if(data?.dateUpdated&&typeof payload?.dateUpdated!="undefined"){const dateUpdatedPayload=payload.dateUpdated;Object.keys(dateUpdatedPayload).forEach(key=>{const dateKey=key;const dateUpdated=dateUpdatedPayload[dateKey];if(dateUpdated){const formattedDateUpdated=(0,$hEp4C$datefns.formatISO)((0,$551d0f39d46708b0$export$2e2bcd8739ae039)(dateUpdated));if(payload.dateUpdated)payload.dateUpdated[dateKey]=formattedDateUpdated}})}const parameter=(0,$parcel$interopDefault($hEp4C$qs)).stringify(payload,{indices:false});const endpoint=`${this.baseUrl}/kakao/v2/templates?${parameter}`;const requestConfig={method:"GET",url:endpoint};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async getKakaoAlimtalkTemplate(templateId){const requestConfig={method:"GET",url:`${this.baseUrl}/kakao/v2/templates/${templateId}`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async getKakaoAlimtalkTemplateCategories(){const requestConfig={method:"GET",url:`${this.baseUrl}/kakao/v2/templates/categories`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async createKakaoAlimtalkTemplate(data){const requestConfig={method:"POST",url:`${this.baseUrl}/kakao/v2/templates`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig,data)}async requestInspectionKakaoAlimtalkTemplate(templateId){const requestConfig={method:"PUT",url:`${this.baseUrl}/kakao/v2/templates/${templateId}/inspection`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async cancelInspectionKakaoAlimtalkTemplate(templateId){const requestConfig={method:"PUT",url:`${this.baseUrl}/kakao/v2/templates/${templateId}/inspection/cancel`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}async updateKakaoAlimtalkTemplate(templateId,data){const requestConfig={method:"PUT",url:`${this.baseUrl}/kakao/v2/templates/${templateId}`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig,data)}async deleteKakaoAlimtalkTemplate(templateId){const requestConfig={method:"DELETE",url:`${this.baseUrl}/kakao/v2/templates/${templateId}`};return(0,$f24672c3715df8a1$export$2e2bcd8739ae039)(this.authInfo,requestConfig)}}